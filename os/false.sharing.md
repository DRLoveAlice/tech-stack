## False Sharing

### Define
- 伪共享的非标准定义:

        缓存系统中是以缓存行（cache line）为单位存储的，当多线程修改互相独立的变量时，
        如果这些变量共享同一个缓存行，就会无意中影响彼此的性能
        
        缓存行上的写竞争是运行在 SMP 系统中并行线程实现可伸缩性最重要的限制因素
- CPU 缓存定义

        CPU 缓存（Cache Memory）是位于 CPU 与内存之间的临时存储器，它的容量比内存小的多，
        但是交换速度却比内存要快得多，高速缓存的出现主要是为了解决 CPU 运算速度与内存读写速
        度不匹配的矛盾，因为 CPU 运算速度要比内存读写速度快很多，这样会使 CPU 花费很长时间
        等待数据到来或把数据写入内存。在缓存中的数据是内存中的一小部分，但这一小部分是短时间
        内 CPU 即将访问的，当 CPU 调用大量数据时，就可避开内存直接从缓存中调用，从而加快读
        取速度
        
        
- M（修改，Modified）：本地处理器已经修改缓存行，即是脏行，它的内容与内存中的内容不一样，并且此 cache 只有本地一个拷贝(专有)；
- E（专有，Exclusive）：缓存行内容和内存中的一样，而且其它处理器都没有这行数据；
- S（共享，Shared）：缓存行内容和内存中的一样, 有可能其它处理器也存在此缓存行的拷贝；
- I（无效，Invalid）：缓存行失效, 不能使用

- 解决 伪共享 问题

        1.缓存行填充(Padding)
        2.编译指示强制使每一个变量对齐
        编译器使用:
        __declspec( align(n) ) 此处 n=64，按照 cache line 边界对齐
        __declspec (align(64)) int thread1_global_variable;
        __declspec (align(64)) int thread2_global_variable;
    